<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.4">
<meta name="keywords" content="AsciiDoc">
<meta name="author" content="Stefan Feilmeier (c) 2018 FENECON GmbH">
<title>Open Energy Management System</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
body{-webkit-font-smoothing:antialiased}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
body{tab-size:4}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
</head>
<body class="article">
<div id="header">
<h1><span class="image related right"><img src="./img/OpenEMS-Logo.png" alt="the Feneco - OpenEMS Logo" width="400"></span>  Open Energy Management System</h1>
<div class="details">
<span id="author" class="author">Stefan Feilmeier (c) 2018 FENECON GmbH</span><br>
<span id="revdate">Version 2018.9.0</span>
</div>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction">1. Introduction</a>
<ul class="sectlevel2">
<li><a href="#_openems_iot_stack">1.1. OpenEMS IoT stack</a></li>
<li><a href="#_features">1.2. Features</a></li>
<li><a href="#_open_source_philosophy">1.3. Open Source philosophy</a></li>
<li><a href="#_license">1.4. License</a></li>
<li><a href="#_development_guidelines">1.5. Development guidelines</a></li>
<li><a href="#_migration_to_osgi">1.6. Migration to OSGi</a></li>
<li><a href="#_system_architecture">1.7. System architecture</a></li>
</ul>
</li>
<li><a href="#_getting_started">2. Getting Started</a>
<ul class="sectlevel2">
<li><a href="#_download_the_source_code">2.1. Download the source code</a></li>
<li><a href="#_setup_eclipse_ide_for_openems_edge_and_backend">2.2. Setup Eclipse IDE for OpenEMS Edge and Backend</a></li>
<li><a href="#_run_openems_edge_and_start_simulator">2.3. Run OpenEMS Edge and start Simulator</a></li>
<li><a href="#_setup_visual_studio_code_for_openems_ui">2.4. Setup Visual Studio Code for OpenEMS UI</a></li>
<li><a href="#_run_openems_ui">2.5. Run OpenEMS UI</a></li>
</ul>
</li>
<li><a href="#_core_concepts_terminology">3. Core concepts &amp; terminology</a>
<ul class="sectlevel2">
<li><a href="#_osgi_bundle">3.1. OSGi Bundle</a></li>
<li><a href="#_openems_component">3.2. OpenEMS Component</a></li>
<li><a href="#_channel">3.3. Channel</a></li>
<li><a href="#_nature">3.4. Nature</a></li>
<li><a href="#_channel_address">3.5. Channel Address</a></li>
<li><a href="#_scheduler">3.6. Scheduler</a></li>
<li><a href="#_controller">3.7. Controller</a></li>
</ul>
</li>
<li><a href="#_openems_edge">4. OpenEMS Edge</a>
<ul class="sectlevel2">
<li><a href="#_architecture">4.1. Architecture</a>
<ul class="sectlevel3">
<li><a href="#_input_process_output">4.1.1. Input-Process-Output</a></li>
<li><a href="#_scheduler_and_controller">4.1.2. Scheduler and Controller</a></li>
<li><a href="#_cycle">4.1.3. Cycle</a></li>
<li><a href="#_asynchronous_threads_and_cycle_synchronization">4.1.4. Asynchronous threads and Cycle synchronization</a></li>
<li><a href="#_architecture_scheme">4.1.5. Architecture scheme</a></li>
</ul>
</li>
<li><a href="#_configuration">4.2. Configuration</a></li>
<li><a href="#_hardware">4.3. Hardware</a>
<ul class="sectlevel3">
<li><a href="#_natures">4.3.1. Natures</a>
<ul class="sectlevel4">
<li><a href="#_ess_energy_storage_system">4.3.1.1. ESS (Energy Storage System)</a></li>
<li><a href="#_meter">4.3.1.2. Meter</a></li>
<li><a href="#_evcs_electric_vehicle_charging_station">4.3.1.3. EVCS (Electric Vehicle Charging Station)</a></li>
<li><a href="#_i_o_digital_input_output">4.3.1.4. I/O (Digital Input/Output)</a></li>
</ul>
</li>
<li><a href="#_bridges">4.3.2. Bridges</a>
<ul class="sectlevel4">
<li><a href="#_modbus_tcp">4.3.2.1. Modbus/TCP</a></li>
<li><a href="#_modbus_rtu">4.3.2.2. Modbus/RTU</a></li>
</ul>
</li>
<li><a href="#_devices_services">4.3.3. Devices &amp; Services</a></li>
<li><a href="#_implementing_a_device">4.3.4. Implementing a Device</a>
<ul class="sectlevel4">
<li><a href="#_step_by_step_guide">4.3.4.1. Step-by-step guide</a></li>
<li><a href="#_synchronize_device_communication">4.3.4.2. Synchronize device communication</a></li>
<li><a href="#_active_reactive_power_control_of_a_battery_inverter">4.3.4.3. Active/Reactive power control of a battery inverter</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_scheduler_2">4.4. Scheduler</a>
<ul class="sectlevel3">
<li><a href="#_existing_schedulers">4.4.1. Existing Schedulers</a></li>
<li><a href="#_developing_a_scheduler">4.4.2. Developing a Scheduler</a></li>
</ul>
</li>
<li><a href="#_controller_2">4.5. Controller</a>
<ul class="sectlevel3">
<li><a href="#_existing_controllers">4.5.1. Existing Controllers</a>
<ul class="sectlevel4">
<li><a href="#_api_backend_controller">4.5.1.1. Api Backend Controller</a></li>
<li><a href="#_api_rest_json_controller">4.5.1.2. Api REST/JSON Controller</a></li>
<li><a href="#_api_websocket_controller">4.5.1.3. Api Websocket Controller</a></li>
<li><a href="#_channel_threshold_controller">4.5.1.4. Channel-Threshold Controller</a></li>
<li><a href="#_debug_detailed_log_controller">4.5.1.5. Debug Detailed-Log Controller</a></li>
<li><a href="#_debug_log_controller">4.5.1.6. Debug Log Controller</a></li>
<li><a href="#_ess_limit_total_discharge">4.5.1.7. Ess Limit Total Discharge</a></li>
<li><a href="#_symmetric_balancing_controller">4.5.1.8. Symmetric Balancing Controller</a></li>
<li><a href="#_symmetric_fix_active_power_controller">4.5.1.9. Symmetric Fix-Active-Power Controller</a></li>
<li><a href="#_symmetric_fix_reactive_power_controller">4.5.1.10. Symmetric Fix-Reactive-Power Controller</a></li>
</ul>
</li>
<li><a href="#_developing_a_controller">4.5.2. Developing a Controller</a></li>
</ul>
</li>
<li><a href="#_build_openems_edge">4.6. Build OpenEMS Edge</a>
<ul class="sectlevel3">
<li><a href="#_build_using_eclipse_ide">4.6.1. Build using Eclipse IDE</a></li>
<li><a href="#_build_using_bnd_from_command_line">4.6.2. Build using bnd from command line</a></li>
</ul>
</li>
<li><a href="#_deploy_openems_edge">4.7. Deploy OpenEMS Edge</a>
<ul class="sectlevel3">
<li><a href="#_connect_via_ssh_and_scp">4.7.1. Connect via SSH and SCP</a>
<ul class="sectlevel4">
<li><a href="#_prepare_operating_system_environment">4.7.1.1. Prepare operating system environment</a></li>
<li><a href="#_update_openems_edge_jar_file">4.7.1.2. Update OpenEMS Edge JAR file</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#_openems_ui">5. OpenEMS UI</a>
<ul class="sectlevel2">
<li><a href="#_architecture_2">5.1. Architecture</a></li>
<li><a href="#_configuration_2">5.2. Configuration</a></li>
<li><a href="#_faq">5.3. FAQ</a></li>
</ul>
</li>
<li><a href="#_openems_backend">6. OpenEMS Backend</a>
<ul class="sectlevel2">
<li><a href="#_architecture_3">6.1. Architecture</a></li>
<li><a href="#_configuration_3">6.2. Configuration</a></li>
</ul>
</li>
<li><a href="#_simulation">7. Simulation</a>
<ul class="sectlevel2">
<li><a href="#_types_of_simulated_components">7.1. Types of Simulated Components</a></li>
<li><a href="#_simulator_components">7.2. Simulator Components</a></li>
<li><a href="#_possible_combinations">7.3. Possible Combinations</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_introduction">1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>OpenEMS is a modular platform for energy management applications.
It was developed around the requirements of controlling, monitoring and integrating energy storage systems together with renewable energy sources and complementary devices and services.</p>
</div>
<div class="sect2">
<h3 id="_openems_iot_stack">1.1. OpenEMS IoT stack</h3>
<div class="paragraph">
<p>The OpenEMS 'Internet of Things' stack contains three main components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>OpenEMS Edge</strong> runs on-site and actually controls the devices</p>
</li>
<li>
<p><strong>OpenEMS UI</strong> is the generic user interface</p>
</li>
<li>
<p><strong>OpenEMS Backend</strong> runs on a (cloud) server, connects the decentralized Edge systems and provides aggregation, monitoring and control via internet</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_features">1.2. Features</h3>
<div class="paragraph">
<p>The OpenEMS software architecture was designed to leverage some features that are required by a modern and flexible Energy Management System:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Fast, PLC-like control of battery inverters and other devices</p>
</li>
<li>
<p>Easily extendable due to the use of modern programming languages and modular architecture</p>
</li>
<li>
<p>Wide range of supported devices - (battery) inverters, meters, etc. - and protocols</p>
</li>
<li>
<p>Modern web-based real-time user interface</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="./img/ui-screenshots.png" alt="Screenshots of OpenEMS UI">
</div>
<div class="title">Figure 1. Screenshots of OpenEMS UI</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./img/ui-screenshots2.png" alt="Screenshots of OpenEMS UI">
</div>
<div class="title">Figure 2. Screenshots of OpenEMS UI</div>
</div>
</div>
<div class="sect2">
<h3 id="_open_source_philosophy">1.3. Open Source philosophy</h3>
<div class="paragraph">
<p>OpenEMS development was started by <a href="https://www.fenecon.de">FENECON GmbH <span class="icon"><i class="fa fa-external-link"></i></span></a>, a German company specialized in manufacturing and project development of energy storage systems. It is the software stack behind <a href="https://fenecon.de/page/fems">FEMS - FENECON Energy Management System <span class="icon"><i class="fa fa-external-link"></i></span></a> and widely used in private, commercial and industrial applications.</p>
</div>
<div class="paragraph">
<p>We are inviting third parties - like universities, hardware manufacturers, software companies, commercial and private owners,&#8230;&#8203; - to use OpenEMS for their own projects and are glad to support them with their first steps. In any case if you are interested in OpenEMS our development team would be glad to hear from you at <a href="mailto:fems@fenecon.de">fems@fenecon.de</a>.</p>
</div>
<div class="paragraph">
<p>OpenEMS is funded by several federal and EU funding projects. If you are a developer and you would like to get hired by one of the partner companies or universities for working on OpenEMS, please send your motivation letter to <a href="mailto:fems@fenecon.de">fems@fenecon.de</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_license">1.4. License</h3>
<div class="ulist">
<ul>
<li>
<p>OpenEMS Edge</p>
</li>
<li>
<p>OpenEMS Backend</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Copyright &#169; 2016-2018 FENECON GmbH.</p>
</div>
<div class="paragraph">
<p>This product includes software developed at FENECON GmbH: you can
redistribute it and/or modify it under the terms of the [Eclipse Public License version 2.0](LICENSE-EPL-2.0).</p>
</div>
<div class="ulist">
<ul>
<li>
<p>OpenEMS UI</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Copyright &#169; 2016-2018 FENECON GmbH.</p>
</div>
<div class="paragraph">
<p>This product includes software developed at FENECON GmbH: you can
redistribute it and/or modify it under the terms of the [GNU Affero General Public License version 3](LICENSE-AGPL-3.0).</p>
</div>
</div>
<div class="sect2">
<h3 id="_development_guidelines">1.5. Development guidelines</h3>
<div class="paragraph">
<p>Development follows the <a href="https://de.wikipedia.org/wiki/Agile_Softwareentwicklung">Agile Manifesto <span class="icon"><i class="fa fa-external-link"></i></span></a> and is driven by the <a href="https://de.wikipedia.org/wiki/Scrum">Scrum <span class="icon"><i class="fa fa-external-link"></i></span></a> methodology.
The source code is available online at <a href="http://openems.io" class="bare">http://openems.io</a> and on <a href="https://github.com/OpenEMS/openems">GitHub <span class="icon"><i class="fa fa-github"></i></span></a>.
New versions are released after every Scrum Sprint and <a href="https://github.com/OpenEMS/openems/releases">tagged <span class="icon"><i class="fa fa-github"></i></span></a> accordingly.
Version numbers are built using the pattern <code>year.number of sprint</code>, e.g. version <code>2018.4</code> is the result of the fourth sprint in 2018.
Git development follows the <a href="https://www.atlassian.com/git/tutorials/comparing-workflows/gitflow-workflow">Gitflow Workflow</a>, so the <a href="https://github.com/OpenEMS/openems/tree/master/">master branch <span class="icon"><i class="fa fa-github"></i></span></a> always holds the stable release, while active development is happening on the <a href="https://github.com/OpenEMS/openems/tree/develop">develop branch <span class="icon"><i class="fa fa-github"></i></span></a> or in separate feature branches.</p>
</div>
<div class="paragraph">
<p>For Edge and Backend Java development we recommend the <a href="https://www.eclipse.org/ide/">Eclipse IDE <span class="icon"><i class="fa fa-external-link"></i></span></a>.
For the UI (TypeScript + Angular.io) we recommend <a href="https://code.visualstudio.com/">Visual Studio Code <span class="icon"><i class="fa fa-external-link"></i></span></a>.
The documentation is generated using <a href="http://asciidoc.org">AsciiDoc <span class="icon"><i class="fa fa-external-link"></i></span></a>.
For handling git we recommend <a href="https://www.sourcetreeapp.com/">Sourctree by Atlassian <span class="icon"><i class="fa fa-external-link"></i></span></a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_migration_to_osgi">1.6. Migration to OSGi</h3>
<div class="paragraph">
<p>Starting with version <a href="https://github.com/OpenEMS/openems/releases/tag/2018.7">2018.7 <span class="icon"><i class="fa fa-github"></i></span></a> OpenEMS Edge is getting migrated to <a href="https://en.wikipedia.org/wiki/OSGi">OSGi <span class="icon"><i class="fa fa-external-link"></i></span></a>, a platform to provide a completely modular and dynamic service oriented system. Certain parts of Edge are not yet migrated and for the time being only available in the deprecated <a href="https://github.com/OpenEMS/openems/tree/old_master">old_master branch <span class="icon"><i class="fa fa-github"></i></span></a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_system_architecture">1.7. System architecture</h3>
<div class="paragraph">
<p>OpenEMS is generally used in combination with external hardware and software components
(the exception is a simulated development environment - see <a href="https://github.com/OpenEMS/openems/blob/old_master/README.md#get-started">Getting Started</a>)
As a brief overview, this is how OpenEMS is used in production setups:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./img/system-architecture.png" alt="OpenEMS system architecture">
</div>
<div class="title">Figure 3. OpenEMS system architecture</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getting_started">2. Getting Started</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This quick 'Getting Started' should help you setup up a complete development environment. On finishing you will have a working instance of OpenEMS Edge, with simulated energy storage and photovoltaic system, as well as an OpenEMS UI for monitoring the simulator inside your web browser.</p>
</div>
<div class="sect2">
<h3 id="_download_the_source_code">2.1. Download the source code</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Download any <a href="https://git-scm.com">git client <span class="icon"><i class="fa fa-external-link"></i></span></a> and install it. Our recommendation is <a href="https://www.sourcetreeapp.com/">Sourctree by Atlassian <span class="icon"><i class="fa fa-external-link"></i></span></a></p>
</li>
<li>
<p>Clone the OpenEMS git repository</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In Sourcetree:</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>press <b class="button">File</b> &#8594; <b class="button">Clone</b></p>
</li>
<li>
<p>enter the git repository path <code><a href="https://github.com/OpenEMS/openems.git" class="bare">https://github.com/OpenEMS/openems.git</a></code></p>
</li>
<li>
<p>select a target directory, for example <code>C:\Users\your.user\git\openems</code></p>
</li>
<li>
<p>open <b class="button">Advanced Settings</b></p>
</li>
<li>
<p>select the branch <b class="button">develop</b></p>
</li>
<li>
<p>and press <b class="button">Clone</b>.</p>
<div class="imageblock">
<div class="content">
<img src="./img/sourcetree.png" alt="Cloning the git repository using Sourcetree">
</div>
<div class="title">Figure 4. Cloning the git repository using Sourcetree</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Alternatively: with the git command line utility</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>open a console</p>
</li>
<li>
<p>change to the target directory</p>
</li>
<li>
<p>execute <code>git clone <a href="https://github.com/OpenEMS/openems.git" class="bare">https://github.com/OpenEMS/openems.git</a> --branch develop</code></p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Git is downloading the complete source code for you.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_setup_eclipse_ide_for_openems_edge_and_backend">2.2. Setup Eclipse IDE for OpenEMS Edge and Backend</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Prepare Eclipse IDE</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Download <a href="http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html">Java SE Development Kit 8 <span class="icon"><i class="fa fa-external-link"></i></span></a> and install it</p>
</li>
<li>
<p>Download <a href="https://www.eclipse.org">Eclipse for Java <span class="icon"><i class="fa fa-external-link"></i></span></a>, install and start it</p>
</li>
<li>
<p>On first start you will get asked to create a workspace.
Select a directory - for example <code>C:\Users\your.user\git\openems-workspace</code> - and press <b class="button">Lauch</b>. <em>The directory needs to be different from your source code directory selected above.</em></p>
<div class="imageblock">
<div class="content">
<img src="./img/eclipse-workspace.png" alt="Creating a workspace in Eclipse IDE">
</div>
<div class="title">Figure 5. Creating a workspace in Eclipse IDE</div>
</div>
</li>
<li>
<p>Install <a href="http://bndtools.org">BndTools <span class="icon"><i class="fa fa-external-link"></i></span></a> in Eclipse:</p>
<div class="paragraph">
<p>Menu: <b class="button">Help</b> →  <b class="button">Eclipse Marketplace&#8230;&#8203;</b> → <b class="button">Find:</b> → enter <b class="button">Bndtools</b> → press <b class="button">Install</b></p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Import OpenEMS component projects (OSGi bundles):</p>
<div class="paragraph">
<p>Menu: <b class="button">File</b> →  <b class="button">Import&#8230;&#8203;</b> → <b class="button">Bndtools</b> → <b class="button">Existing Bnd Workspace</b> → Root directory: <b class="button">Browse&#8230;&#8203;</b> → select the directory with the source code - for example <code>C:\Users\your.user\git\openems</code> → <b class="button">OK</b> → <b class="button">Finish</b> → "Switch to Bndtools perspective?" <b class="button">yes</b></p>
</div>
</li>
<li>
<p>Eclipse should have successfully built OpenEMS Edge and Backend, showing no entry in Problems.</p>
<div class="imageblock">
<div class="content">
<img src="./img/eclipse-no-problems.png" alt="Eclipse IDE showing 'no problems'">
</div>
<div class="title">Figure 6. Eclipse IDE showing 'no problems'</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_run_openems_edge_and_start_simulator">2.3. Run OpenEMS Edge and start Simulator</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Run OpenEMS Edge</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In Eclipse IDE open the project <b class="button">io.openems.edge.application</b> and double click on <b class="button">EdgeApp.run</b>.</p>
<div class="imageblock">
<div class="content">
<img src="./img/eclipse-io.openems.edge.application.png" alt="io.openems.edge.application project in Eclipse IDE">
</div>
<div class="title">Figure 7. io.openems.edge.application project in Eclipse IDE</div>
</div>
</li>
<li>
<p>Click on <b class="button">Run OSGi</b> to run OpenEMS Edge. You should see log outputs on the console inside Eclipse IDE.</p>
<div class="imageblock">
<div class="content">
<img src="./img/eclipse-edge-initial-log-output.png" alt="OpenEMS Edge initial log output">
</div>
<div class="title">Figure 8. OpenEMS Edge initial log output</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Configure and start the Simulator</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Open the <a href="http://localhost:8080/system/console/configMgr">Apache Felix Web Console Configuration <span class="icon"><i class="fa fa-external-link"></i></span></a>.</p>
<div class="paragraph">
<p>Login with username <strong>admin</strong> and password <strong>admin</strong>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./img/apache-felix-console-configuration.png" alt="Apache Felix Web Console Configuration">
</div>
<div class="title">Figure 9. Apache Felix Web Console Configuration</div>
</div>
</li>
<li>
<p>Configure a Scheduler</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The Scheduler is responsible for executing the control algorithms (Controllers) and defines the OpenEMS Edge application cycle
</td>
</tr>
</table>
</div>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>Click on "Scheduler All Alphabetically"</p>
<div class="imageblock">
<div class="content">
<img src="./img/config-scheduler-all-alphabetically.png" alt="Configuration of All Alphabetically Scheduler">
</div>
<div class="title">Figure 10. Configuration of All Alphabetically Scheduler</div>
</div>
</li>
<li>
<p>Accept the default values and click <b class="button">Save</b></p>
</li>
<li>
<p>You created your first instance of an OpenEMS Component with ID "scheduler0". The log shows:</p>
<div class="paragraph">
<p><code>INFO  [onent.AbstractOpenemsComponent] [scheduler0] Activate AllAlphabetically [edge.scheduler.allalphabetically]</code></p>
</div>
<div class="paragraph">
<p>Add any other OpenEMS Components in the same way:</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Configure debug outputs on the console: "Controller Debug Log". The default values can be accepted without changes.</p>
<div class="imageblock">
<div class="content">
<img src="./img/config-controller-debug-log.png" alt="Configuration of Controller Debug Log">
</div>
<div class="title">Figure 11. Configuration of Controller Debug Log</div>
</div>
<div class="paragraph">
<p>The log shows:</p>
</div>
<div class="paragraph">
<p><code>INFO  [onent.AbstractOpenemsComponent] [ctrlDebugLog0] Activate DebugLog [edge.controller.debuglog]</code>,</p>
</div>
<div class="paragraph">
<p>followed once per second by</p>
</div>
<div class="paragraph">
<p><code>INFO  [e.controller.debuglog.DebugLog] [ctrlDebugLog0] _sum[Ess SoC:0 %|L:0 W Grid L:0 W Production L:0 W Consumption L:0 W]</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is once per second because you accepted the default value of "1000 ms" for "Cycle time" in the Scheduler configuration.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Configure the standard-load-profile datasource using the according input file in the csv-reader: "Simulator DataSource: CSVReader". The default values can be accepted without changes. The "Source" value is already set to the right input file.</p>
<div class="imageblock">
<div class="content">
<img src="./img/config-simulator-datasource-standard-load-profile.png" alt="Configuration of Simulator DataSource: CSVReader as standard load profile datasource">
</div>
<div class="title">Figure 12. Configuration of Simulator DataSource: CSVReader as standard load profile datasource</div>
</div>
<div class="paragraph">
<p>The log shows:</p>
</div>
<div class="paragraph">
<p><code>INFO  [onent.AbstractOpenemsComponent] [datasource0] Activate CSVDatasource [edge.simulator.datasource.csv]</code>,</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The data source was configured with the OpenEMS Component ID "datasource0" which will be used in the next step as reference.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Configure a simulated grid meter: "Simulator GridMeter Acting". Configure the Datasource-ID "datasource0" to refer to the data source configured above.</p>
<div class="imageblock">
<div class="content">
<img src="./img/config-simulator-grid-meter-acting.png" alt="Configuration of Simulator GridMeter Acting">
</div>
<div class="title">Figure 13. Configuration of Simulator GridMeter Acting</div>
</div>
<div class="paragraph">
<p>This time some more logs will show up. Most importantly they show, that the Grid meter now shows a power value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>INFO  [onent.AbstractOpenemsComponent] [meter0] Activate GridMeter [edge.simulator.meter.grid.acting]
[onent.AbstractOpenemsComponent] [meter0] Deactivate GridMeter [edge.simulator.meter.grid.acting]
[onent.AbstractOpenemsComponent] [meter0] Activate GridMeter [edge.simulator.meter.grid.acting]
[e.controller.debuglog.DebugLog] [ctrlDebugLog0] _sum[Ess SoC:0 %|L:0 W Grid L:1423 W Production L:0 W Consumption L:1423 W] meter0[1423 W]</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This setup causes the simulated grid-meter to take the standardized load-profiles data as input parameter.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
'Acting' referrs to the fact, that this meter actively provides data - in opposite to a 'Reacting' device that is reacting on other components: for example the 'Simulator.EssSymmetric.Reacting' configured below.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Configure a simulated reacting energy storage system: "Simulator EssSymmetric Reacting". The default values can be accepted without changes.</p>
<div class="imageblock">
<div class="content">
<img src="./img/config-simulator-esssymmetric-reacting.png" alt="Configuration of Simulator EssSymmetric Reacting">
</div>
<div class="title">Figure 14. Configuration of Simulator EssSymmetric Reacting</div>
</div>
<div class="paragraph">
<p>The log shows:</p>
</div>
<div class="paragraph">
<p><code>INFO  [e.controller.debuglog.DebugLog] [ctrlDebugLog0] _sum[Ess SoC:50 %|L:0 W Grid L:864 W Production L:0 W Consumption L:864 W] ess0[SoC:50 %|L:0 W|OnGrid] meter0[864 W]</code></p>
</div>
<div class="paragraph">
<p>Note, that the DebugLog now shows data for the battery, but the charge/discharge power stays at "0 W" and the state of charge stays at "50 %" as configured. Next step is to configure a control algorithm that tells the battery to charge or discharge.</p>
</div>
</li>
<li>
<p>Configure the self-consumption optimization algorithm: "Controller Balancing Symmetric". Configure the Ess-ID "ess0" and Grid-Meter-ID "meter0" to refer to the components configured above.</p>
<div class="imageblock">
<div class="content">
<img src="./img/config-controller-balancing-symmetric.png" alt="Configuration of Symmetric Balancing Controller">
</div>
<div class="title">Figure 15. Configuration of Symmetric Balancing Controller</div>
</div>
<div class="paragraph">
<p>The log shows:</p>
</div>
<div class="paragraph">
<p><code>INFO  [e.controller.debuglog.DebugLog] [ctrlDebugLog0] _sum[Ess SoC:49 %|L:1167 W Grid L:-39 W Production L:0 W Consumption L:1128 W] ess0[SoC:49 %|L:1167 W|OnGrid] meter0[-39 W]</code></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Note, how the Controller now tells the battery to discharge (<code>Ess SoC:49 %|L:1167 W</code>), trying to balance the Grid power to "0 W" (<code>Grid L:-39 W</code>):
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Configure the websocket Api Controller: "Controller Api Websocket". The default values can be accepted without changes.</p>
<div class="imageblock">
<div class="content">
<img src="./img/config-controller-api-websocket.png" alt="Configuration of Controller Api Websocket">
</div>
<div class="title">Figure 16. Configuration of Controller Api Websocket</div>
</div>
<div class="paragraph">
<p>The log shows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>INFO  [onent.AbstractOpenemsComponent] [ctrlApiWebsocket0] Activate WebsocketApi [edge.controller.api.websocket]
INFO  [ler.api.websocket.WebsocketApi] [ctrlApiWebsocket0] Websocket-Api started on port [8085].</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The Controller Api Websocket is required to enable access to OpenEMS Edge by a local OpenEMS UI.
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_setup_visual_studio_code_for_openems_ui">2.4. Setup Visual Studio Code for OpenEMS UI</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Download <a href="https://nodejs.org">node.js LTS <span class="icon"><i class="fa fa-external-link"></i></span></a> and install it.</p>
</li>
<li>
<p>Download <a href="https://code.visualstudio.com/">Visual Studio Code <span class="icon"><i class="fa fa-external-link"></i></span></a>, install and start it.</p>
</li>
<li>
<p>Open OpenEMS UI source code in Visual Studio Code:</p>
<div class="paragraph">
<p>Menu: <b class="button">File</b> → <b class="button">Open directory&#8230;&#8203;</b> → Select the <code>ui</code> directory inside the downloaded source code (for example <code>C:\Users\your.user\git\openems\ui</code>) → <b class="button">Select directory</b></p>
</div>
</li>
<li>
<p>Open the integrated terminal:</p>
<div class="paragraph">
<p>Menu: <b class="button">Show</b> → <b class="button">Integrated terminal</b></p>
</div>
</li>
<li>
<p>Install <a href="https://cli.angular.io/">Angular CLI <span class="icon"><i class="fa fa-external-link"></i></span></a>:</p>
<div class="paragraph">
<p><code>npm install -g @angular/cli</code></p>
</div>
</li>
<li>
<p>Resolve and download dependencies:</p>
<div class="paragraph">
<p><code>npm install</code></p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_run_openems_ui">2.5. Run OpenEMS UI</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In Visual Studios integrated terminal type&#8230;&#8203;</p>
<div class="paragraph">
<p><code>ng serve</code></p>
</div>
<div class="paragraph">
<p>The log shows:</p>
</div>
<div class="paragraph">
<p><code>NG Live Development Server is listening on localhost:4200, open your browser on <a href="http://localhost:4200/" class="bare">http://localhost:4200/</a></code></p>
</div>
</li>
<li>
<p>Open a browser at <a href="http://localhost:4200" class="bare">http://localhost:4200</a></p>
</li>
<li>
<p>You should see OpenEMS UI. Log in as user "guest" by clicking on the tick mark. Alternatively type "admin" in the password field to log in with extended permissions.</p>
<div class="imageblock">
<div class="content">
<img src="./img/openems-ui-login.png" alt="OpenEMS UI Login screen">
</div>
<div class="title">Figure 17. OpenEMS UI Login screen</div>
</div>
</li>
<li>
<p>Change to the Energymonitor by clicking on the arrow.</p>
<div class="imageblock">
<div class="content">
<img src="./img/openems-ui-overview.png" alt="OpenEMS UI Overview screen">
</div>
<div class="title">Figure 18. OpenEMS UI Overview screen</div>
</div>
</li>
<li>
<p>You should see the Energymonitor showing the same data as the DebugLog output on the console.</p>
<div class="imageblock">
<div class="content">
<img src="./img/openems-ui-edge-overview.png" alt="OpenEMS UI Energymonitor screen">
</div>
<div class="title">Figure 19. OpenEMS UI Energymonitor screen</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
OpenEMS UI will complain that "no timedata source is available". Because of this the historic chart is not yet functional.
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_core_concepts_terminology">3. Core concepts &amp; terminology</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes some of the core concepts and commonly used terms in OpenEMS:</p>
</div>
<div class="sect2">
<h3 id="_osgi_bundle">3.1. OSGi Bundle</h3>
<div class="paragraph">
<p>OpenEMS Edge is using the <a href="https://en.wikipedia.org/wiki/OSGi">OSGi <span class="icon"><i class="fa fa-external-link"></i></span></a> platform to provide a completely modular and dynamic service oriented system.</p>
</div>
<div class="paragraph">
<p>Logical groups of source code are put into one OSGi Bundle. Every directory in the source code root directory starting with 'io.openems.*' is a bundle.</p>
</div>
</div>
<div class="sect2">
<h3 id="_openems_component">3.2. OpenEMS Component</h3>
<div class="paragraph">
<p>OpenEMS Edge is built of Components, i.e. every main component implements the <a href="../io.openems.edge.common/src/io/openems/edge/common/component/OpenemsComponent.java">OpenemsComponent interface <span class="icon"><i class="fa fa-code"></i></span></a>.</p>
</div>
<div class="paragraph">
<p>By definition each Component has a unique ID. Those <strong>Component-IDs</strong> are typically:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ess0</code> for the first storage system or battery inverter</p>
</li>
<li>
<p><code>ess1</code> for the second storage system or battery inverter</p>
</li>
<li>
<p>&#8230;&#8203;</p>
</li>
<li>
<p><code>meter0</code> for the first meter in the system</p>
</li>
<li>
<p>&#8230;&#8203;</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you receive your OpenEMS together with a FENECON energy storage system, you will find the following Component-IDs:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>FENECON Pro</p>
<div class="ulist">
<ul>
<li>
<p><code>ess0</code>: FENECON Pro Ess</p>
</li>
<li>
<p><code>meter0</code>: Socomec grid meter</p>
</li>
<li>
<p><code>meter1</code>: FENECON Pro production meter</p>
</li>
</ul>
</div>
</li>
<li>
<p>FENECON Mini</p>
<div class="ulist">
<ul>
<li>
<p><code>ess0</code>: FENECON Mini</p>
</li>
<li>
<p><code>meter0</code>: FENECON Mini grid meter</p>
</li>
<li>
<p><code>meter1</code>: FENECON Mini production meter</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_channel">3.3. Channel</h3>
<div class="paragraph">
<p>Each OpenemsComponent provides a number of Channels. Each represents a single piece of information. Each Channel implements the <a href="../io.openems.edge.common/src/io/openems/edge/common/channel/Channel.java">Channel interface <span class="icon"><i class="fa fa-code"></i></span></a>. By definition each Channel has a unique ID within its parent Component.</p>
</div>
</div>
<div class="sect2">
<h3 id="_nature">3.4. Nature</h3>
<div class="paragraph">
<p>Natures extend normal Java interfaces with 'Channels'. If a Component implements a Nature it also needs to provide the required Channels. For example the Energy Storage System (ESS) Simulator <a href="../io.openems.edge.simulator/src/io/openems/edge/simulator/ess/symmetric/reacting/EssSymmetric.java">Simulator.EssSymmetric.Reacting <span class="icon"><i class="fa fa-code"></i></span></a> implements the <a href="../io.openems.edge.ess.api/src/io/openems/edge/ess/api/Ess.java">Ess interface <span class="icon"><i class="fa fa-code"></i></span></a> and therefor needs to provide a <code>Soc</code> Channel that provides the current 'State of Charge' of the battery.</p>
</div>
<div class="paragraph">
<p><a href="#_controller">Controller</a>s are written against Nature implementations. Example: A Controller can be used with any ESS, because it can be sure that it provides all the data the Controller requires for its algorithm.</p>
</div>
</div>
<div class="sect2">
<h3 id="_channel_address">3.5. Channel Address</h3>
<div class="paragraph">
<p>By combining the unique <strong>Component-ID</strong> and <strong>Channel-ID</strong> each Channel in the system can be addressed by a distinct 'Channel Address' in the form <code>Component-ID/Channel-ID</code>.</p>
</div>
<div class="paragraph">
<p>Example: the state of charge ("Soc") of the first energy storage system ("ess0") has the channel address <code>ess0/Soc</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_scheduler">3.6. Scheduler</h3>
<div class="paragraph">
<p>The Scheduler handles the order, in which Controllers are executed. For details see <a href="#_scheduler_and_controller">Scheduler and Controller</a> below.</p>
</div>
</div>
<div class="sect2">
<h3 id="_controller">3.7. Controller</h3>
<div class="paragraph">
<p>The actual business logic or algorithms are wrapped as 'Controllers'. i.e. they implement the <a href="../io.openems.edge.controller.api/src/io/openems/edge/controller/api/Controller.java">Controller interface <span class="icon"><i class="fa fa-code"></i></span></a>. Each Controller holds one specific, encapsulated task.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_openems_edge">4. OpenEMS Edge</h2>
<div class="sectionbody">
<div class="paragraph">
<p>OpenEMS Edge is the core component of the energy management that runs on-site and is responsible for communicating with and controling of external hardware like battery systems, inverters, meters and so on.</p>
</div>
<div class="sect2">
<h3 id="_architecture">4.1. Architecture</h3>
<div class="paragraph">
<p>The OpenEMS Edge software architecture is carefully designed to abstract device communication and control algorithms in a way to provide maximum flexibility, predictability and stability, while simplifying the process of implementing new components.</p>
</div>
<div class="sect3">
<h4 id="_input_process_output">4.1.1. Input-Process-Output</h4>
<div class="paragraph">
<p>OpenEMS Edge is built around the well-known IPO (input-process-output) model which defines the internal execution cycle.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./img/input-process-output.png" alt="Input-Process-Output model">
</div>
<div class="title">Figure 20. Input-Process-Output model</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Input</dt>
<dd>
<p>During the input phase all relevant information - e.g. the current 'state of charge' of a battery - is collected and provided as a <strong>process image</strong>. This process image is guaranteed to never change during the cycle.</p>
</dd>
<dt class="hdlist1">Process</dt>
<dd>
<p>The process phase runs algorithms and tasks based on the process image - e.g. an algorithm uses the 'state of charge' information to evaluate whether a digital output should be turned on.</p>
</dd>
<dt class="hdlist1">Output</dt>
<dd>
<p>The output phase takes the results from the process phase and applies it - e.g. it turns the digital output on or off.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_scheduler_and_controller">4.1.2. Scheduler and Controller</h4>
<div class="paragraph">
<p>During the 'process' phase different algorithms (Controllers) might try to access the same resources - e.g. two Controllers try to switch the same digital output. It is therefor necessary to prioritize their execution and restrict access according to priority.</p>
</div>
<div class="paragraph">
<p>OpenEMS Edge uses Scheduler implementations to receive a sorted list of Controllers. The Controllers are then executed in order. Later executed Controllers are not allowed to overwrite a previously written result.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./img/input-process-scheduler-output.png" alt="IPO model with Scheduler and Controllers">
</div>
<div class="title">Figure 21. IPO model with Scheduler and Controllers</div>
</div>
</div>
<div class="sect3">
<h4 id="_cycle">4.1.3. Cycle</h4>
<div class="paragraph">
<p>The input-process-output model in OpenEMS Edge is executed in a Cycle - implemented by the <a href="../io.openems.edge.core/src/io/openems/edge/cycle/Cycle.java">Cycle component <span class="icon"><i class="fa fa-code"></i></span></a>). It handles the setting of a process image in the input phase and executes the Controllers in the process phase. Furthermore it emits Cycle Events that can be used in other Components to synchronize with the Cycle.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./img/edge-cycle.png" alt="OpenEMS Edge Cycle">
</div>
<div class="title">Figure 22. OpenEMS Edge Cycle</div>
</div>
</div>
<div class="sect3">
<h4 id="_asynchronous_threads_and_cycle_synchronization">4.1.4. Asynchronous threads and Cycle synchronization</h4>
<div class="paragraph">
<p>Communication with external hardware and services needs to be executed in asynchronous threads to not block the system. At the same time, those threads need to synchronize with the Cycle.</p>
</div>
<div class="paragraph">
<p>The following example shows, how the <a href="../io.openems.edge.bridge.modbus/src/io/openems/edge/bridge/modbus/AbstractModbusBridge.java">Modbus implementation <span class="icon"><i class="fa fa-code"></i></span></a> uses Cycle Events to synchronize with the Cycle:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./img/cycle-modbus.png" alt="Synchronize Cycle with Modbus read/write">
</div>
<div class="title">Figure 23. Synchronize Cycle with Modbus read/write</div>
</div>
</div>
<div class="sect3">
<h4 id="_architecture_scheme">4.1.5. Architecture scheme</h4>
<div class="paragraph">
<p>The following scheme shows the abstraction of hardware via Channels, Natures and Devices as well as the execution of control algorithms via Scheduler and Controllers.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./img/device-nature-channel-scheduler-controller.png" alt="Architecture scheme">
</div>
<div class="title">Figure 24. Architecture scheme</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuration">4.2. Configuration</h3>
<div class="paragraph">
<p>OpenEMS Edge and Backend are configured using the standard OSGi configuration admin service. The easiest way to set a configuration is via the <a href="http://localhost:8080/system/console/configMgr">Apache Felix Web Console Configuration <span class="icon"><i class="fa fa-external-link"></i></span></a> as described in the <a href="#_getting_started">Getting Started</a> guide above.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./img/apache-felix-console-configuration.png" alt="Apache Felix Web Console Configuration">
</div>
<div class="title">Figure 25. Apache Felix Web Console Configuration</div>
</div>
<div class="paragraph">
<p>Configuration via OpenEMS UI is currently not available due to the ongoing <a href="#_migration_to_osgi">Migration to OSGi</a>. Once migration is finished, it is going to be possible to change every configuration using the settings menu in OpenEMS UI - directly to OpenEMS Edge and via Backend.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./img/ui-config.png" alt="OpenEMS UI Configuration">
</div>
<div class="title">Figure 26. OpenEMS UI Configuration</div>
</div>
</div>
<div class="sect2">
<h3 id="_hardware">4.3. Hardware</h3>
<div class="paragraph">
<p>This chapter covers hardware related topics around OpenEMS Edge.
It describes how physical hardware is abstracted using <em>Natures</em>, how standardized physical connection layers and protocols are implemented using <em>Bridges</em> and shows which <em>Devices and Services</em> are implemented. The chapter concludes with a development tutorial on how to implement a device.</p>
</div>
<div class="sect3">
<h4 id="_natures">4.3.1. Natures</h4>
<div class="paragraph">
<p>Physical hardware is abstracted in OpenEMS Edge using <em>Natures</em>. A Nature defines a set of characteristics and attributes which need to be provided by each OpenEMS component that implements it. These characteristics are defined by Channels. For example an implementation of an <code>Ess</code> (Energy Storage System), needs to provide an <code>Soc</code>-Channel (State of charge of the battery).</p>
</div>
<div class="paragraph">
<p>Technically Natures are implemented as OSGi API Bundles.</p>
</div>
<div class="sect4">
<h5 id="_ess_energy_storage_system">4.3.1.1. ESS (Energy Storage System)</h5>
<div class="paragraph">
<p>An Energy Storage System is an integrated system with battery and battery inverter.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="../io.openems.edge.ess.api/src/io/openems/edge/ess/api/Ess.java">Ess <span class="icon"><i class="fa fa-code"></i></span></a></dt>
<dd>
<p>A generic Energy Storage System</p>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Soc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">%</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">State of Charge</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GridMode</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0=Undefined, 1=On-Grid, 2=Off-Grid</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MaxActivePower</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">W</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum possible Active Power</p></td>
</tr>
</tbody>
</table>
</dd>
<dt class="hdlist1"><a href="../io.openems.edge.ess.api/src/io/openems/edge/ess/symmetric/readonly/api/SymmetricEssReadonly.java">SymmetricEssReadonly <span class="icon"><i class="fa fa-code"></i></span></a></dt>
<dd>
<p>A symmetric Energy Storage System in readonly-mode.</p>
</dd>
<dt class="hdlist1"><a href="../io.openems.edge.ess.api/src/io/openems/edge/ess/symmetric/api/SymmetricEss.java">SymmetricEss <span class="icon"><i class="fa fa-code"></i></span></a></dt>
<dd>
<p>A symmetric, controllable Energy Storage System.</p>
</dd>
</dl>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="../io.openems.edge.ess.api/src/io/openems/edge/ess/dccharger/api/EssDcCharger.java">EssDcCharger <span class="icon"><i class="fa fa-code"></i></span></a></dt>
<dd>
<p>A solar charger that is connected to DC side of an energy storage system.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_meter">4.3.1.2. Meter</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="../io.openems.edge.meter.api/src/io/openems/edge/meter/api/Meter.java">Meter <span class="icon"><i class="fa fa-code"></i></span></a></dt>
<dd>
<p>A generic electric power meter.</p>
</dd>
<dt class="hdlist1"><a href="../io.openems.edge.meter.api/src/io/openems/edge/meter/symmetric/api/SymmetricMeter.java">SymmetricMeter <span class="icon"><i class="fa fa-code"></i></span></a></dt>
<dd>
<p>A power meter for symmetric metering.</p>
</dd>
<dt class="hdlist1"><a href="../io.openems.edge.meter.api/src/io/openems/edge/meter/asymmetric/api/AsymmetricMeter.java">AsymmetricMeter <span class="icon"><i class="fa fa-code"></i></span></a></dt>
<dd>
<p>A power meter for asymmetric metering.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_evcs_electric_vehicle_charging_station">4.3.1.3. EVCS (Electric Vehicle Charging Station)</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="../io.openems.edge.evcs.api/src/io/openems/edge/evcs/api/Evcs.java">Evcs <span class="icon"><i class="fa fa-code"></i></span></a></dt>
<dd>
<p>A charging station for electric vehicles like e-cars and e-buses.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_i_o_digital_input_output">4.3.1.4. I/O (Digital Input/Output)</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="../io.openems.edge.io.api/src/io/openems/edge/io/api/DigitalOutput.java">DigitalOutput <span class="icon"><i class="fa fa-code"></i></span></a></dt>
<dd>
<p>One or more digital outputs or relays.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_bridges">4.3.2. Bridges</h4>
<div class="paragraph">
<p>To simplify the implementation of hardware that is connected via certain standardized physical connection layers and protocols, those are implemented as Bridges.</p>
</div>
<div class="sect4">
<h5 id="_modbus_tcp">4.3.2.1. Modbus/TCP</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="../io.openems.edge.bridge.modbus/src/io/openems/edge/bridge/modbus/BridgeModbusTcp.java">Modbus/TCP <span class="icon"><i class="fa fa-code"></i></span></a></dt>
<dd>
<p><a href="https://en.wikipedia.org/wiki/Modbus">Modbus/TCP <span class="icon"><i class="fa fa-external-link"></i></span></a> is a widely used standard for fieldbus connections via TCP/IP network. It is used by all kinds of hardware devices like photovoltaics inverters, electric meters, and so on.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_modbus_rtu">4.3.2.2. Modbus/RTU</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="../io.openems.edge.bridge.modbus/src/io/openems/edge/bridge/modbus/BridgeModbusSerial.java">Modbus/Serial <span class="icon"><i class="fa fa-code"></i></span></a></dt>
<dd>
<p><a href="https://en.wikipedia.org/wiki/Modbus">Modbus/RTU <span class="icon"><i class="fa fa-external-link"></i></span></a> is a widely used standard for fieldbus connections via RS485 serial bus. It is used by all kinds of hardware devices like photovoltaics inverters, electric meters, and so on.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_devices_services">4.3.3. Devices &amp; Services</h4>

</div>
<div class="sect3">
<h4 id="_implementing_a_device">4.3.4. Implementing a Device</h4>
<div class="sect4">
<h5 id="_step_by_step_guide">4.3.4.1. Step-by-step guide</h5>
<div class="paragraph">
<p>This chapter explains the steps required to implement a Device in OpenEMS Edge. The example shows the implementation of a <a href="http://www.socomec.co.uk/range-single-circuit-multifunction-meters_en.htlm?product=/diris-a14_en.html">SOCOMEC DIRIS A14 power meter <span class="icon"><i class="fa fa-external-link"></i></span></a>. The communication is via Modbus/RTU. The actual source code of the implementation can be found <a href="../io.openems.edge.meter.socomec.dirisa14/src/io/openems/edge/meter/socomec/dirisa14/MeterSocomecDirisA14.java">here <span class="icon"><i class="fa fa-code"></i></span></a>.</p>
</div>
<div class="paragraph">
<p>The tutorial is based on the <a href="#_getting_started">Getting Started</a> guide.</p>
</div>
<div class="sect5">
<h6 id="_create_a_new_osgi_bundle">Create a new OSGi Bundle</h6>
<div class="paragraph">
<p>For more information see <a href="#_osgi_bundle">OSGi Bundle</a>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the menu choose <b class="button">File</b> &#8594; <b class="button">New</b> &#8594; <b class="button">Other</b></p>
<div class="imageblock">
<div class="content">
<img src="./img/eclipse-file-new-other.png" alt="Creating a new project in Eclipse IDE">
</div>
<div class="title">Figure 27. Creating a new project in Eclipse IDE</div>
</div>
</li>
<li>
<p>Select <b class="button">Bndtools</b> &#8594; <b class="button">Bnd OSGi Project</b> and press <b class="button">Next &gt;</b></p>
<div class="imageblock">
<div class="content">
<img src="./img/eclipse-bndtools-osgi-project.png" alt="Creating a Bnd OSGi Project in Eclipse IDE">
</div>
<div class="title">Figure 28. Creating a Bnd OSGi Project in Eclipse IDE</div>
</div>
</li>
<li>
<p>Select <b class="button">OSGi enRoute</b> &#8594; <b class="button">Provider/Adapter Bundle</b> and press <b class="button">Next &gt;</b></p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Technically an OpenEMS Edge Device provides implementations of the interfaces of an OSGi <em>API Bundle</em>. In OSGi terminology this is called a <em>Provider/Adapter Bundle</em>
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="./img/eclipse-new-osgi-provider-bundle.png" alt="Creating a Bnd OSGi Provider/Adapter Bundle in Eclipse IDE">
</div>
<div class="title">Figure 29. Creating a Bnd OSGi Provider/Adapter Bundle in Eclipse IDE</div>
</div>
</li>
<li>
<p>Choose a project name and press <b class="button">Next &gt;</b></p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The project name is used as the folder name in OpenEMS source directory. The naming is up to you, but it is good practice to keep the name lower case and use something like <strong>io.openems.[edge/backend].[purpose/nature].[implementation]</strong>. For a SOCOMEC DIRIS A14 that is implementing the Meter nature <code>io.openems.edge.meter.socomec.dirisa14</code> is a good choice.
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="./img/eclipse-new-osgi-provider-socomec.png" alt="Naming a Bnd OSGi Provider/Adapter Bundle in Eclipse IDE">
</div>
<div class="title">Figure 30. Naming a Bnd OSGi Provider/Adapter Bundle in Eclipse IDE</div>
</div>
</li>
<li>
<p>Accept defaults for the final screen and press <b class="button">Finish</b></p>
<div class="imageblock">
<div class="content">
<img src="./img/eclipse-new-osgi-provider-socomec-final.png" alt="Java settings for a Bnd OSGi Provider/Adapter Bundle in Eclipse IDE">
</div>
<div class="title">Figure 31. Java settings for a Bnd OSGi Provider/Adapter Bundle in Eclipse IDE</div>
</div>
</li>
<li>
<p>The assistant closes and you can see your new bundle.</p>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="_define_bundle_dependencies">Define Bundle dependencies</h6>
<div class="paragraph">
<p>OSGi Bundles can be dependent on certain other Bundles. This information can be set in a <strong>bnd.bnd</strong> file.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Select the component directory <b class="button">src</b> &#8594; <b class="button">io.openems.edge.meter.socomec.dirisa14</b></p>
<div class="imageblock">
<div class="content">
<img src="./img/eclipse-new-socomec-bundle.png" alt="New SOCOMEC DIRIS A14 Bnd OSGi Provider/Adapter Bundle in Eclipse IDE">
</div>
<div class="title">Figure 32. New SOCOMEC DIRIS A14 Bnd OSGi Provider/Adapter Bundle in Eclipse IDE</div>
</div>
</li>
<li>
<p>Open the <b class="button">bnd.bnd</b> file by double clicking on it.</p>
</li>
<li>
<p>Open the <b class="button">Build</b> tab</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can see, that the Bundle is currently dependent on a core OSGi API bundle ('osgi.enroute.base.api'). We are going to expand that list.
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="./img/eclipse-bnd-file-build.png" alt="Bndtools Build configuration">
</div>
<div class="title">Figure 33. Bndtools Build configuration</div>
</div>
</li>
<li>
<p>Click the <b class="button">+</b> symbol next to <strong>Build Path</strong>.</p>
<div class="imageblock">
<div class="content">
<img src="./img/eclipse-osgi-build-path.png" alt="Bndtools Build Path configuration">
</div>
<div class="title">Figure 34. Bndtools Build Path configuration</div>
</div>
</li>
<li>
<p>Use the <strong>Project Build Path</strong> assistant to add the following Bundles as dependencies:</p>
<div class="dlist">
<dl>
<dt class="hdlist1">io.openems.edge.common</dt>
<dd>
<p>The Edge Common Bundle provides implementations and services that are common to all OpenEMS Edge components.</p>
</dd>
<dt class="hdlist1">io.openems.edge.meter.api</dt>
<dd>
<p>The Meter API Bundle provides the interfaces for OpenEMS Edge Meter Nature.</p>
</dd>
<dt class="hdlist1">io.openems.edge.bridge.modbus</dt>
<dd>
<p>The Modbus Bundle provides the Bridge services for Modbus/RTU and Modbus/TCP protocols.</p>
</dd>
</dl>
</div>
</li>
<li>
<p>It is also a good moment to configure the Bundle meta information. Still inside the <b class="button">bnd.bnd</b> file open the <b class="button">Source</b> tab. Add some meta information - it will help the users of your component:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Bundle-Name: OpenEMS Edge Meter SOCOMEC DirisA14
Bundle-Vendor: FENECON GmbH
Bundle-License: https://opensource.org/licenses/EPL-2.0
Bundle-Version: 1.0.0.${tstamp}
Export-Package: \
	io.openems.edge.meter.api,\
	io.openems.edge.meter.asymmetric.api,\
	io.openems.edge.meter.symmetric.api
Private-Package: io.openems.edge.meter.socomec.dirisa14

-includeresource: {readme.md}

-buildpath: \
	osgi.enroute.base.api;version=2.1,\
	io.openems.edge.meter.api;version=latest,\
	io.openems.edge.bridge.modbus;version=latest,\
	io.openems.edge.common;version=latest

-testpath: \
	osgi.enroute.junit.wrapper;version=4.12, \
	osgi.enroute.hamcrest.wrapper;version=1.3</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="_define_configuration_parameters">Define configuration parameters</h6>
<div class="paragraph">
<p>OpenEMS Components can have several configuration parameters. They are defined as Java annotations and specific OSGi annotations are used to generate meta information that is used e.g. by Apache Felix Web Console to generate a user interface form (see <a href="#_getting_started">Getting Started</a>).</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that the component directory is still selected.</p>
</li>
<li>
<p>In the menu choose <b class="button">File</b> &#8594; <b class="button">New</b> &#8594; <b class="button">Other</b></p>
</li>
<li>
<p>Select <b class="button">Java</b> &#8594; <b class="button">Class</b> and press <b class="button">Next &gt;</b></p>
<div class="imageblock">
<div class="content">
<img src="./img/eclipse-new-annotation.png" alt="Creating a Java annotation in Eclipse IDE">
</div>
<div class="title">Figure 35. Creating a Java annotation in Eclipse IDE</div>
</div>
</li>
<li>
<p>Set the name <strong>Config</strong> press <b class="button">Finish</b>.</p>
<div class="imageblock">
<div class="content">
<img src="./img/eclipse-new-config-annotation.png" alt="Creating the Java annotation 'Config' in Eclipse IDE">
</div>
<div class="title">Figure 36. Creating the Java annotation 'Config' in Eclipse IDE</div>
</div>
</li>
<li>
<p>A Java annotation template was generated for you:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">package io.openems.edge.meter.socomec.dirisa14;

public @interface Config {

}</code></pre>
</div>
</div>
</li>
<li>
<p>Adjust the template to match the following code:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">package io.openems.edge.meter.socomec.dirisa14;

import org.osgi.service.metatype.annotations.AttributeDefinition;
import org.osgi.service.metatype.annotations.ObjectClassDefinition;

@ObjectClassDefinition( <i class="conum" data-value="1"></i><b>(1)</b>
		name = "Meter SOCOMEC Diris A14", //
		description = "Implements the SOCOMEC Diris A14 meter.")
@interface Config {
	String service_pid(); <i class="conum" data-value="2"></i><b>(2)</b>

	String id() default "meter0"; <i class="conum" data-value="3"></i><b>(3)</b>

	boolean enabled() default true; <i class="conum" data-value="4"></i><b>(4)</b>

	@AttributeDefinition(name = "Meter-Type", description = "Grid, Production (=default), Consumption") <i class="conum" data-value="5"></i><b>(5)</b>
	MeterType type() default MeterType.PRODUCTION; <i class="conum" data-value="6"></i><b>(6)</b>

	@AttributeDefinition(name = "Modbus-ID", description = "ID of Modbus brige.")
	String modbus_id(); <i class="conum" data-value="7"></i><b>(7)</b>

	@AttributeDefinition(name = "Modbus Unit-ID", description = "The Unit-ID of the Modbus device.")
	int modbusUnitId(); <i class="conum" data-value="8"></i><b>(8)</b>

	@AttributeDefinition(name = "Modbus target filter", description = "This is auto-generated by 'Modbus-ID'.")
	String Modbus_target() default ""; <i class="conum" data-value="9"></i><b>(9)</b>

	@AttributeDefinition(name = "Minimum Ever Active Power", description = "This is automatically updated.")
	int minActivePower(); <i class="conum" data-value="10"></i><b>(10)</b>

	@AttributeDefinition(name = "Maximum Ever Active Power", description = "This is automatically updated.")
	int maxActivePower(); <i class="conum" data-value="10"></i><b>(10)</b>

	String webconsole_configurationFactory_nameHint() default "Meter SOCOMEC Diris A14 [{id}]"; <i class="conum" data-value="11"></i><b>(11)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <strong>@ObjectClassDefinition</strong> annotation defines this file as a Meta Type Resource for OSGi configuration admin. Use it to set a <em>name</em> and <em>description</em> for this OpenEMS Component.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <strong>service_pid</strong> is used in internally by OpenEMS Edge framework and is automatically filled by OSGi.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <strong>id</strong> configuration parameter sets the OpenEMS Component-ID (see <a href="#_channel_address">Channel Address</a>). <em>Note</em>: A <strong>default</strong> ID 'meter0' is defined. It is good practice to define such an ID here, as it simplifies configuration in the UI.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <strong>enabled</strong> parameter provides a <em>soft</em> way of deactivating an OpenEMS Component programmatically.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The <strong>@AttributeDefinition</strong> annotation provides meta information about a configuration parameter like <em>name</em> and <em>description</em>.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>The 'Meter' nature requires definition of a MeterType that defines the purpose of the Meter. We will let the user define this type by a configuration parameter.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>The 'Modbus-ID' parameter creates the link to a Modbus-Service via its OpenEMS Component-ID. At runtime the user will typically set this configuration parameter to something like 'modbus0'.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>The Modbus service implementation requires us to provide the Modbus <em>Unit-ID</em> (also commonly called <em>Device-ID</em> or <em>Slave-ID</em>) of the Modbus slave device. This is the ID that is configured at the SOCOMEC DIRIS.</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>The <strong>Modbus_target</strong> will be automatically set by OpenEMS framework and does usually not need to be configured by the user. <em>Note</em>: Linking other OpenEMS Components is implemented using OSGi References. The OpenEMS Edge framework therefor sets the 'target' property of a reference to filter the matched services.</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>The default Meter implementation uses configuration parameters <strong>minActivePower</strong> and <strong>maxActivePower</strong> to store the minimum/maximum ever experienced active power. By providing them here the User can possibly adjust them if required.</td>
</tr>
<tr>
<td><i class="conum" data-value="11"></i><b>11</b></td>
<td>The <strong>webconsole_configurationFactory_nameHint</strong> parameter sets a custom name for Apache Felix Web Console, helping the user to find the correct bundle.</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="_implement_the_openems_component">Implement the OpenEMS Component</h6>
<div class="paragraph">
<p>Next step is to actually implement the OpenEMS Component as an OSGi Bundle.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The Bndtools assistant created a <code>ProviderImpl.java</code> file. First step is to set a proper name for this file. To rename the file, select it by clicking on it and choose <b class="button">Refactor</b> &#8594; <b class="button">Rename&#8230;&#8203;</b> in the menu. Write <code>MeterSocomecDirisA14</code> as 'New name' and press <b class="button">Finish</b>.</p>
<div class="imageblock">
<div class="content">
<img src="./img/eclipse-rename.png" alt="Renaming a Java class in Eclipse IDE">
</div>
<div class="title">Figure 37. Renaming a Java class in Eclipse IDE</div>
</div>
<div class="paragraph">
<p>Afterwards the <code>MeterSocomecDirisA14.java</code> file has the following content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">package io.openems.edge.meter.socomec.dirisa14;

import java.util.Map;

import org.osgi.service.component.annotations.Activate;
import org.osgi.service.component.annotations.Component;
import org.osgi.service.component.annotations.Deactivate;
import org.osgi.service.metatype.annotations.ObjectClassDefinition;
import org.osgi.service.metatype.annotations.Designate;

@Designate(ocd = MeterSocomecDirisA14.Config.class, factory = true) <i class="conum" data-value="1"></i><b>(1)</b>
@Component(name = "io.openems.edge.meter.socomec.dirisa14") <i class="conum" data-value="2"></i><b>(2)</b>
public class MeterSocomecDirisA14 {

	@ObjectClassDefinition
	@interface Config { <i class="conum" data-value="3"></i><b>(3)</b>
		String name() default "World";
	}

	private String name;

	@Activate
	void activate(Config config) { <i class="conum" data-value="4"></i><b>(4)</b>
		this.name = config.name();
	}

	@Deactivate <i class="conum" data-value="5"></i><b>(5)</b>
	void deactivate() {
	}

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <strong>@Designate</strong> annotation is used for OSGi to create a connection to a <em>Config</em> annotation class. It also defines this Component as a <em>factory</em>, i.e. it can produce multiple instances with different configurations.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <strong>@Component</strong> annotation marks this class as an OSGi component and sets a unique name.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The template for <em>OSGi Provider/Adapter Bundles</em> comes with an embedded example Config definition.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <strong>activate()</strong> method (marked by the <strong>@Activate</strong> annotation) is called on activation of an object instance of this Component. It comes with an instance of a configuration in the form of a Config object.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The <strong>deactivate()</strong> method (marked by the <strong>@Deactivate</strong> annotation) is called on deactivation of the Component instance.</td>
</tr>
</table>
</div>
</li>
<li>
<p>We can see, that by default there is an embedded '@interface Config' file. Which is referred to by the '@Designate' annotation. As we implemented our own <strong>Config.java</strong> file externally, we can adjust as follows to use our implementation:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">package io.openems.edge.meter.socomec.dirisa14;

import org.osgi.service.component.annotations.Activate;
import org.osgi.service.component.annotations.Component;
import org.osgi.service.component.annotations.Deactivate;
import org.osgi.service.metatype.annotations.Designate;

@Designate(ocd = Config.class, factory = true)
@Component(name = "io.openems.edge.meter.socomec.dirisa14")
public class MeterSocomecDirisA14 {

	@Activate
	void activate(Config config) {
	}

	@Deactivate
	void deactivate() {
	}

}</code></pre>
</div>
</div>
</li>
<li>
<p>It is good practice to adjust the <strong>@Component</strong> annotation a little bit:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">@Component(name = "Meter.SOCOMEC.DirisA14", <i class="conum" data-value="1"></i><b>(1)</b>
		immediate = true, <i class="conum" data-value="2"></i><b>(2)</b>
		configurationPolicy = ConfigurationPolicy.REQUIRE) <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Configure a human-readable name in the form <strong>[nature].[vendor].[product]</strong>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Configure the Component to be started immediately after configuration, i.e. it is not waiting till its service is required by another Component.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Define that the configuration of the Component is required before it gets activated.</td>
</tr>
</table>
</div>
</li>
<li>
<p>We have an OSGi Component. To make it an OpenEMS Edge Component, we need to implement the <strong>OpenemsComponent</strong> interface. To ease the implementation of all required functionalities we can simply inherit from the <strong>AbstractOpenemsComponent</strong> class. As our device is connected using Modbus, there is an additional convinience layer in the form of the <strong>AbstractOpenemsModbusComponent</strong> available.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In plain Java it is not required to add <code>implements OpenemsComponent</code> if we inherit from 'AbstractOpenemsComponent' or 'AbstractOpenemsModbusComponent'. Be aware that for OSGi dependency injection to function properly, it is stil required to mention all implemented interfaces again, as it is not considering the complete inheritance tree.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We adjust the code as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">@Designate(ocd = Config.class, factory = true)
@Component(name = "Meter.SOCOMEC.DirisA14", //
		immediate = true, //
		configurationPolicy = ConfigurationPolicy.REQUIRE)
public class MeterSocomecDirisA14 extends AbstractOpenemsModbusComponent implements OpenemsComponent { <i class="conum" data-value="1"></i><b>(1)</b>

	@Activate
	void activate(ComponentContext context, Config config) { <i class="conum" data-value="2"></i><b>(2)</b>
		super.activate(context, config.service_pid(), config.id(), config.enabled(), config.modbusUnitId(), this.cm,
				"Modbus", config.modbus_id()); <i class="conum" data-value="3"></i><b>(3)</b>
	}

	@Deactivate
	protected void deactivate() {
		super.deactivate(); <i class="conum" data-value="3"></i><b>(3)</b>
	}

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The class extends <strong>AbstractOpenemsModbusComponent</strong> and specifically implements <strong>OpenemsComponent</strong> again. This makes it an <a href="#_openems_component">OpenEMS Component</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <strong>activate()</strong> method can be adjusted to not only take a Config object, but also provides a <em>ComponentContext</em>. OSGi takes care of providing both on activation of the Component.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>All logic for activating and deactivating the OpenEMS Component is hidden in the super class and just needs to be called from here.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that after this step you will still see two errors: Eclipse complains that we need to implement a method <code>defineModbusProtocol()</code> and that it does not know <code>this.cm</code>. We will fix that in the next two steps.</p>
</div>
</li>
<li>
<p>The <code>super.activate()</code> method requires an instance of <strong>ConfigurationAdmin</strong> as a parameter. The ConfigurationAdmin is an external service which can be provided to our Component via dependency injection. Using OSGi Declarative Services annotations we just need to add the following two lines within the class - OSGi takes care of the rest:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">@Reference
protected ConfigurationAdmin cm;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This solves the first error. We can now refer to an instance of <em>ConfigurationAdmin</em> via <code>this.cm</code>.</p>
</div>
</li>
<li>
<p><em>AbstractOpenemsModbusComponent</em> requires us to implement a <strong>defineModbusProtocol()</strong> method that returns an instance of <strong>ModbusProtocol</strong>. The <em>ModbusProtocol</em> class maps Modbus addresses to OpenEMS <a href="#_channel">Channel</a>s and provides some conversion utilities. Instantiation of a <em>ModbusProtocol</em> object heavily uses the <a href="https://en.wikipedia.org/wiki/Builder_pattern#Java">Builder pattern <span class="icon"><i class="fa fa-external-link"></i></span></a></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">@Override
protected ModbusProtocol defineModbusProtocol(int unitId) {
    return new ModbusProtocol(unitId, <i class="conum" data-value="1"></i><b>(1)</b>
            new FC3ReadRegistersTask(0xc558, Priority.HIGH, <i class="conum" data-value="2"></i><b>(2)</b>
                    ...
                    m(AsymmetricMeter.ChannelId.CURRENT_L1, new UnsignedDoublewordElement(0xc560)), <i class="conum" data-value="3"></i><b>(3)</b>
                    ...
                    m(SymmetricMeter.ChannelId.ACTIVE_POWER, new SignedDoublewordElement(0xc568),ElementToChannelConverter.SCALE_FACTOR_1), <i class="conum" data-value="4"></i><b>(4)</b>
                    ...
                    new DummyRegisterElement(0xc56C, 0xc56F), <i class="conum" data-value="5"></i><b>(5)</b>
                    ...
                    cm(new UnsignedDoublewordElement(0xc558)) <i class="conum" data-value="6"></i><b>(6)</b>
                        .m(AsymmetricMeter.ChannelId.VOLTAGE_L1, ElementToChannelConverter.SCALE_FACTOR_1) //
                        .m(SymmetricMeter.ChannelId.VOLTAGE, ElementToChannelConverter.SCALE_FACTOR_1) //
                        .build(), //
            ));
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Creates a <strong>new ModbusProtocol</strong> instance. The Modbus <strong>Unit-ID</strong> - which is provided by the method itself - is the first parameter, followed by an arbitrary number of 'Tasks' (implemented as a Java varags array).</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><strong>FC3ReadRegistersTask</strong> is an implementation of Modbus <a href="http://www.simplymodbus.ca/FC03.htm">function code 3 "Read Holding Registers" <span class="icon"><i class="fa fa-external-link"></i></span></a>. Its first parameter is the start address of the register block. The second parameter is a priority information that defines how often this register block needs to be queried. Following parameters are an arbitrary number of <strong>ModbusElements</strong></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>This command uses the internal <strong>m()</strong> method to make a simple 1-to-1 mapping between the Modbus element at address <code>0xc560</code> and the Channel <em>AsymmetricMeter.ChannelId.CURRENT_L1</em>. The Modbus element is defined as a 32 bit doubleword element with an unsigned integer value.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <em>m()</em> method also takes an instance of <strong>ElementToChannelConverter</strong> as an additional parameter. This example uses <em>ElementToChannelConverter.SCALE_FACTOR_1</em> to add a scale factor to the conversion that converts a Modbus read value of "95" to a channel value of "950".</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>For Modbus registers that are empty or should be ignored, the <strong>DummyRegisterElement</strong> can be used.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>This example uses the internal method <strong>cm()</strong> which provides more advanced channel-to-element mapping functionalities. The example maps the Modbus element to two Channels.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Using this principle a complete Modbus table consisting of multiple register blocks that need to be read or written with different Modbus function codes can be defined. For details have a look at the existing implementation classes inside the Modbus Bridge source code.</p>
</div>
</li>
<li>
<p>OpenEMS <a href="#_channel">Channel</a>s have a two-stage implementation. <em>Declaration</em> happens inside the Nature - for common Channels - and the Component - for custom Channels specific to the Device. <em>Definition</em> (i.e. instantiation of the Channel object) happens inside the Component.</p>
<div class="paragraph">
<p>For now we only used Channels defined by the Meter Nature, e.g. <a href="../io.openems.edge.meter.api/src/io/openems/edge/meter/symmetric/api/SymmetricMeter.java">SymmetricMeter.ChannelId.ACTIVE_POWER' <span class="icon"><i class="fa fa-code"></i></span></a>. It is still good practice to add a skeleton for custom Channels <strong>Declaration</strong> to the Component implementation. We therefor add the following <em>Channel Declaration</em> block inside the class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">public enum ChannelId implements io.openems.edge.common.channel.doc.ChannelId { <i class="conum" data-value="1"></i><b>(1)</b>
    ; <i class="conum" data-value="2"></i><b>(2)</b>
    private final Doc doc;

    private ChannelId(Doc doc) { <i class="conum" data-value="3"></i><b>(3)</b>
        this.doc = doc;
    }

    public Doc doc() {
        return this.doc;
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Channel declarations are <strong>enum</strong> types implementing the ChannelId interface.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>This enum is empty, as we do not have custom Channels here.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>ChannelId enums require a Doc object that provides meta information about the Channel - e.g. the above ACTIVE_POWER Channel is defined as <code>ACTIVE_POWER(new Doc().type(OpenemsType.INTEGER).unit(Unit.WATT)</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>After the Declaration of the Channels we also need the <strong>Definition</strong>.
A good place for the Definition of the Channels is inside the object constructor, to be sure that the Channels are always defined and avoid NullPointerExceptions.
It is good practice to move Channel definition to an external static <em>Utils.initializeChannels()</em> method to keep our Component file short and clean.
We use Java Streams to facilitate the Definition of Channels</p>
</div>
<div class="paragraph">
<p>Create a new file <strong>Utils.java</strong> with the following content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">package io.openems.edge.meter.socomec.dirisa14;

import java.util.Arrays;
import java.util.stream.Stream;

import io.openems.edge.common.channel.AbstractReadChannel;
import io.openems.edge.common.channel.IntegerReadChannel;
import io.openems.edge.common.channel.StateChannel;
import io.openems.edge.common.component.OpenemsComponent;
import io.openems.edge.meter.api.Meter;
import io.openems.edge.meter.asymmetric.api.AsymmetricMeter;
import io.openems.edge.meter.symmetric.api.SymmetricMeter;

public class Utils {
	public static Stream&lt;? extends AbstractReadChannel&lt;?&gt;&gt; initializeChannels(MeterSocomecDirisA14 c) { <i class="conum" data-value="1"></i><b>(1)</b>
		return Stream.of( //
				Arrays.stream(OpenemsComponent.ChannelId.values()).map(channelId -&gt; { <i class="conum" data-value="2"></i><b>(2)</b>
					switch (channelId) { <i class="conum" data-value="3"></i><b>(3)</b>
					case STATE:
						return new StateChannel(c, channelId); <i class="conum" data-value="4"></i><b>(4)</b>
					}
					return null;
				}), Arrays.stream(Meter.ChannelId.values()).map(channelId -&gt; { <i class="conum" data-value="2"></i><b>(2)</b>
					switch (channelId) { <i class="conum" data-value="3"></i><b>(3)</b>
					case FREQUENCY:
						return new IntegerReadChannel(c, channelId); <i class="conum" data-value="4"></i><b>(4)</b>
					}
					return null;
				}), Arrays.stream(SymmetricMeter.ChannelId.values()).map(channelId -&gt; { <i class="conum" data-value="2"></i><b>(2)</b>
					switch (channelId) { <i class="conum" data-value="3"></i><b>(3)</b>
					case ACTIVE_POWER:
						return new IntegerReadChannel(c, channelId); <i class="conum" data-value="4"></i><b>(4)</b>
					}
					return null;
				}), Arrays.stream(AsymmetricMeter.ChannelId.values()).map(channelId -&gt; { <i class="conum" data-value="2"></i><b>(2)</b>
					switch (channelId) { <i class="conum" data-value="3"></i><b>(3)</b>
					case ACTIVE_POWER_L1:
					case ACTIVE_POWER_L2:
					case ACTIVE_POWER_L3:
						return new IntegerReadChannel(c, channelId); <i class="conum" data-value="4"></i><b>(4)</b>
					}
					return null;
				})/*
					 * , Arrays.stream(MeterSocomecDirisA14.ChannelId.values()).map(channelId -&gt; {
					 * switch (channelId) { } return null; })
					 */ //
		).flatMap(channel -&gt; channel);
	}
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The static <strong>initializeChannels()</strong> method returns a Java Stream of Channel objects.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Using Streams the Java lambda function is called for each declared ChannelId. This command is repeated for every Nature that is implemented by the OpenEMS Component.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Using a switch-case statement each ChannelId can be evaluated. <em>Note:</em> Because we are using enums together with switch-case, Eclipse IDE is able to find out if we covered every Channel and post a warning if we did not.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>This line creates the actual Definition of the Channel and returns a Channel object instance of the required type.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that after this step you will see many warnings like 'The enum constant CURRENT needs a corresponding case label in this enum switch on SymmetricMeter.ChannelId'. Eclipse IDE 'Quick Fix' provides an option 'Add missing case statements' that will generate the missing switch-cases for you.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./img/eclipse-channels-switch-case.png" alt="Eclipse IDE Quick Fix for switch-case">
</div>
<div class="title">Figure 38. Eclipse IDE Quick Fix for switch-case</div>
</div>
<div class="paragraph">
<p>Finally we need to call the <em>Utils.initializeChannels()</em> from the Component constructor. Add the following code to the Component code. It receives a Stream of Channel objects and adds all of them to the Component using the <code>addChannel()</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">public MeterSocomecDirisA14() {
    Utils.initializeChannels(this).forEach(channel -&gt; this.addChannel(channel));
}</code></pre>
</div>
</div>
</li>
<li>
<p>Our OpenEMS Component utilizes an external Modbus Component for the actual Modbus communication. We receive an instance of this service via dependency injection (like we did already for the <em>ConfigurationAdmin</em> service). Most of the magic is handled by the <em>AbstractOpenemsModbusComponent</em> implementation. We only need to add the following code to the Component:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">@Reference(policy = ReferencePolicy.STATIC, policyOption = ReferencePolicyOption.GREEDY, cardinality = ReferenceCardinality.MANDATORY)
protected void setModbus(BridgeModbus modbus) {
    super.setModbus(modbus);
}</code></pre>
</div>
</div>
</li>
<li>
<p>The Device that we are implementing provides the Natures <strong>SymmetricMeter, AsymmetricMeter and Meter</strong>. We already defined those in the <em>initializeChannels()</em> method. Additionally the Component also needs to implement the Nature interfaces.</p>
<div class="paragraph">
<p>Change the class declaration as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">public class MeterSocomecDirisA14 extends AbstractOpenemsModbusComponent
		implements SymmetricMeter, AsymmetricMeter, Meter, OpenemsComponent {</code></pre>
</div>
</div>
</li>
<li>
<p>The <strong>Meter</strong> Nature requires us to implement a <code>MeterType getMeterType()</code> method. The MeterType was provided by the Config, so we simply take the config parameter inside the <em>activate()</em> method:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">private MeterType meterType = MeterType.PRODUCTION; <i class="conum" data-value="1"></i><b>(1)</b>

@Activate
void activate(ComponentContext context, Config config) {
    // get Meter Type:
    this.meterType = config.type(); <i class="conum" data-value="2"></i><b>(2)</b>
    ...
}

@Override
public MeterType getMeterType() { <i class="conum" data-value="3"></i><b>(3)</b>
    return this.meterType;
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Declare the class variable <em>meterType</em> with a default value.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Store the config parameter.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Implement the <em>getMeterType()</em> method that returns the meterType.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Meter stores the <em>Min/MaxActivePower</em> as configuration parameters. This is handled internally and just needs to be initialized using the <strong>SymmetricMeter.<em>initializeMinMaxActivePower()</strong> method inside the _activate()</em> method.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">this._initializeMinMaxActivePower(this.cm, config.service_pid(), config.minActivePower(), config.maxActivePower());</code></pre>
</div>
</div>
</li>
<li>
<p>Finally it is always a good idea to define a <strong>debugLog()</strong> method. This method is called in each cycle by the <strong>Controller.Debug.Log</strong> and very helpful for continuous debugging:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">@Override
public String debugLog() {
    return "L:" + this.getActivePower().value().asString();
}</code></pre>
</div>
</div>
</li>
<li>
<p>To actually run the Component, open the <strong>io.openems.edge.application</strong> project and open the <a href="../io.openems.edge.application/EdgeApp.bndrun">EdgeApp.bndrun <span class="icon"><i class="fa fa-code"></i></span></a> file. Search for your Bundle and drag-and-drop it to the <strong>Run Requirements</strong>.</p>
<div class="imageblock">
<div class="content">
<img src="./img/eclipse-edgeapp-bndrun.png" alt="Eclipse IDE EdgeApp.bndrun">
</div>
<div class="title">Figure 39. Eclipse IDE EdgeApp.bndrun</div>
</div>
<div class="paragraph">
<p>Press <b class="button">Resolve</b> to dissolve the dependencies and accept the <em>Resolution Results</em> window with <b class="button">Finish</b>.</p>
</div>
<div class="paragraph">
<p>Then press <b class="button">Run OSGi</b> to run OpenEMS Edge. From then you can configure your component as shown in <a href="#_getting_started">Getting Started</a>.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_synchronize_device_communication">4.3.4.2. Synchronize device communication</h5>

</div>
<div class="sect4">
<h5 id="_active_reactive_power_control_of_a_battery_inverter">4.3.4.3. Active/Reactive power control of a battery inverter</h5>

</div>
</div>
</div>
<div class="sect2">
<h3 id="_scheduler_2">4.4. Scheduler</h3>
<div class="sect3">
<h4 id="_existing_schedulers">4.4.1. Existing Schedulers</h4>

</div>
<div class="sect3">
<h4 id="_developing_a_scheduler">4.4.2. Developing a Scheduler</h4>

</div>
</div>
<div class="sect2">
<h3 id="_controller_2">4.5. Controller</h3>
<div class="sect3">
<h4 id="_existing_controllers">4.5.1. Existing Controllers</h4>
<div class="sect4">
<h5 id="_api_backend_controller">4.5.1.1. Api Backend Controller</h5>
<div class="paragraph">
<p>Establishes the connection to OpenEMS Backend.</p>
</div>
</div>
<div class="sect4">
<h5 id="_api_rest_json_controller">4.5.1.2. Api REST/JSON Controller</h5>
<div class="paragraph">
<p>Provides a REST-Api for external access to OpenEMS Edge. The default port for the server is <strong>8084</strong>; so the default base address for REST calls is <code><a href="http://x:&lt;PASSWORD&gt;@&lt;IP&gt;:8084/rest" class="bare">http://x:&lt;PASSWORD&gt;@&lt;IP&gt;:8084/rest</a></code>, where</p>
</div>
<div class="ulist">
<ul>
<li>
<p>"http" is the protocol</p>
</li>
<li>
<p>"x" is the user. Authentification in OpenEMS is via password only, so username can be anything.</p>
</li>
<li>
<p>"&lt;PASSWORD&gt;" is the user password. If no specifi settings have been made, try 'user' or 'admin' here.</p>
</li>
<li>
<p>"8084" is the configured port</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A good way to test REST-Api calls is via the Chrome extension <a href="https://chrome.google.com/webstore/detail/restlet-client-rest-api-t/aejoelaoggembcahagimdiliamlcdmfm">Restlet</a></p>
</div>
<div class="paragraph">
<p>Api-Endpoints:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/channel/&lt;ThingId&gt;/&lt;ChannelName&gt;</code></p>
<div class="paragraph">
<p>Provides access to a channel value. Example: use a GET request to <a href="http://x:user@localhost:8084/rest/_sum/EssSoC" class="bare">http://x:user@localhost:8084/rest/_sum/EssSoC</a> to get the current average state of charge.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_api_websocket_controller">4.5.1.3. Api Websocket Controller</h5>
<div class="paragraph">
<p>Server for connection from OpenEMS UI to OpenEMS Edge.</p>
</div>
</div>
<div class="sect4">
<h5 id="_channel_threshold_controller">4.5.1.4. Channel-Threshold Controller</h5>
<div class="paragraph">
<p>Switch I/Os according to Channel-Value, e.g. State-of-Charge of the battery.</p>
</div>
</div>
<div class="sect4">
<h5 id="_debug_detailed_log_controller">4.5.1.5. Debug Detailed-Log Controller</h5>
<div class="paragraph">
<p>Output detailed debug information about specific Components on the console.</p>
</div>
</div>
<div class="sect4">
<h5 id="_debug_log_controller">4.5.1.6. Debug Log Controller</h5>
<div class="paragraph">
<p>Output generic information about every Component on every cycle.</p>
</div>
</div>
<div class="sect4">
<h5 id="_ess_limit_total_discharge">4.5.1.7. Ess Limit Total Discharge</h5>
<div class="paragraph">
<p>Avoid total discharge of an energy storage system (ESS). Allows to define a Min-SoC and Force-Charge-SoC.</p>
</div>
</div>
<div class="sect4">
<h5 id="_symmetric_balancing_controller">4.5.1.8. Symmetric Balancing Controller</h5>
<div class="paragraph">
<p>Symmetric self-consumption optimization.</p>
</div>
</div>
<div class="sect4">
<h5 id="_symmetric_fix_active_power_controller">4.5.1.9. Symmetric Fix-Active-Power Controller</h5>
<div class="paragraph">
<p>Allows setting of a fixed Active-Power value for an ESS.</p>
</div>
</div>
<div class="sect4">
<h5 id="_symmetric_fix_reactive_power_controller">4.5.1.10. Symmetric Fix-Reactive-Power Controller</h5>
<div class="paragraph">
<p>Allows setting of a fixed Reactive-Power value for an ESS.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_developing_a_controller">4.5.2. Developing a Controller</h4>

</div>
</div>
<div class="sect2">
<h3 id="_build_openems_edge">4.6. Build OpenEMS Edge</h3>
<div class="paragraph">
<p>This chapter explains, how OpenEMS Edge can be compiled to a JAR file that can be executed outside of an IDE.</p>
</div>
<div class="sect3">
<h4 id="_build_using_eclipse_ide">4.6.1. Build using Eclipse IDE</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Inside Eclipse IDE open the <strong>io.openems.edge.application</strong> project and open the <a href="../io.openems.edge.application/EdgeApp.bndrun">EdgeApp.bndrun <span class="icon"><i class="fa fa-code"></i></span></a> file.</p>
<div class="imageblock">
<div class="content">
<img src="./img/eclipse-edgeapp-bndrun.png" alt="Eclipse IDE EdgeApp.bndrun">
</div>
<div class="title">Figure 40. Eclipse IDE EdgeApp.bndrun</div>
</div>
</li>
<li>
<p>Press <b class="button">Export</b> to start the <strong>Export Wizard Selection</strong> assistant.</p>
</li>
<li>
<p>Select <b class="button">Executable JAR</b> and press <b class="button">Next &gt;</b>.</p>
<div class="imageblock">
<div class="content">
<img src="./img/eclipse-bnd-file-export.png" alt="Eclipse Export Wizard Selection assistant">
</div>
<div class="title">Figure 41. Eclipse Export Wizard Selection assistant</div>
</div>
</li>
<li>
<p>Select a <strong>Destination</strong> for <strong>Export to JAR</strong>.</p>
<div class="imageblock">
<div class="content">
<img src="./img/eclipse-bnd-file-export-destination.png" alt="Eclipse Export Destination">
</div>
<div class="title">Figure 42. Eclipse Export Destination</div>
</div>
</li>
<li>
<p>Press <b class="button">Finish</b></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This creates a so called Fat-JAR-file including all bundles. It can be executed by running <code>java -jar openems.jar</code> in a console.</p>
</div>
</div>
<div class="sect3">
<h4 id="_build_using_bnd_from_command_line">4.6.2. Build using bnd from command line</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Install bnd on the command line. See <a href="https://github.com/bndtools/bnd/wiki/Install-bnd-on-the-command-line">bnd wiki <span class="icon"><i class="fa fa-external-link"></i></span></a> for details. (Following I assume that you download the biz.aQute.bnd.jar file to the parent directory of your repository.)</p>
</li>
<li>
<p>Open a console and change to your repository directory.</p>
</li>
<li>
<p>Execute <code>java -jar biz.aQute.bnd.jar package -o openems.jar io.openems.edge.application\EdgeApp.bndrun</code></p>
</li>
<li>
<p>This creates a Fat-JAR 'openems.jar' in the base directory of the repository.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_deploy_openems_edge">4.7. Deploy OpenEMS Edge</h3>
<div class="paragraph">
<p>This chapter explains how OpenEMS can be deployed on a Debian Linux Internet-of-Things Gateway. Similar techniques will work for other operating systems as well.</p>
</div>
<div class="paragraph">
<p>This guide covers a simple, manual approach. For productive systems it is required to automate deployment to IoT devices. Good approaches include a Debian package repository that provides *.deb-files and third-party tools like <a href="http://www.eclipse.org/hawkbit/">Eclipse Hawkbit</a>. This is out-of-scope for this small guide.</p>
</div>
<div class="paragraph">
<p>Prerequisites:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A target device running Debian Linux like a Raspberry Pi, Beaglebone Black or an IoT gateway. You need the IP address and SSH access.</p>
</li>
<li>
<p>Create a JAR-file that should be deployes. See <a href="#_build_openems_edge">Build OpenEMS Edge</a> for details.</p>
</li>
<li>
<p>Setup an SSH client to connect to the Linux console, e.g. <a href="http://www.9bis.net/kitty/">KiTTY</a></p>
</li>
<li>
<p>Setup an SCP client to copy the JAR file via SSH, e.g. <a href="https://winscp.net/eng/docs/lang:de">WinSCP</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_connect_via_ssh_and_scp">4.7.1. Connect via SSH and SCP</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Connect via SSH using KiTTY</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Open KiTTY and connect to the target device.</p>
<div class="paragraph">
<p>Make sure to select SSH with port 22 and enter the IP address of the target device. Press the <b class="button">Open</b> button.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./img/deploy-kitty.png" alt="KiTTY Configuration">
</div>
<div class="title">Figure 43. KiTTY Configuration</div>
</div>
</li>
<li>
<p>Gain root permissions either by logging in as user <strong>root</strong> or by login in as a default user and executing <strong>sudo -s</strong>.</p>
<div class="imageblock">
<div class="content">
<img src="./img/deploy-ssh-root.png" alt="KiTTY Configuration">
</div>
<div class="title">Figure 44. KiTTY Configuration</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
As an example, for the FENECON Energy Management System (FEMS) it is required to:<br>
<em>login as:</em> <code>fems</code><br>
<em>fems@192.168.178.38&#8217;s password:</em> <code>device specific password</code><br>
&#8230;&#8203;<br>
<em>fems@femsXXX:~$</em> <code>sudo -s</code><br>
<em>[sudo] password for fems:</em> <code>device specific password</code><br>
<em>root@femsXXX:/home/fems#</em>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Connect via SCP using WinSCP</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>If you are lucky and have a fully configured system, right-click on the KiTTY window bar and select <b class="button">Start WinSCP</b>.</p>
<div class="imageblock">
<div class="content">
<img src="./img/deploy-kitty-start-winscp.png" alt="Start WinSCP from KiTTY">
</div>
<div class="title">Figure 45. Start WinSCP from KiTTY</div>
</div>
</li>
<li>
<p>Otherwise open WinSCP separately, create a new connection, select <strong>SCP</strong> as protocol and enter again the IP address and port 22. Click <b class="button">Connect</b> once finished.</p>
<div class="imageblock">
<div class="content">
<img src="./img/deploy-winscp.png" alt="Start WinSCP from KiTTY">
</div>
<div class="title">Figure 46. Start WinSCP from KiTTY</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="_prepare_operating_system_environment">4.7.1.1. Prepare operating system environment</h5>
<div class="sect5">
<h6 id="_create_an_application_directory">Create an application directory</h6>
<div class="paragraph">
<p>Create the directory <strong>/usr/lib/openems</strong>. This is going to be the place, where we put the JAR file.</p>
</div>
<div class="paragraph">
<p>Execute <code>mkdir /usr/lib/openems</code>.</p>
</div>
</div>
<div class="sect5">
<h6 id="_create_a_config_directory">Create a config directory</h6>
<div class="paragraph">
<p>Create the directory <strong>/etc/openems.d</strong>. This is going to be the place, where all the bundle configurations are held.</p>
</div>
<div class="paragraph">
<p>Execute <code>mkdir /etc/openems.d</code>.</p>
</div>
</div>
<div class="sect5">
<h6 id="_create_a_systemd_service_definition">Create a systemd service definition</h6>
<div class="paragraph">
<p>The systemd 'Service Manager' manages system processes in a Debian Linux. We will create a systemd service definition file, so that systemd takes care of managing (starting/restarting/&#8230;&#8203;) the OpenEMS Edge service.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create and open the service definition file.</p>
<div class="paragraph">
<p>Execute <code>nano /etc/systemd/system/openems.service</code></p>
</div>
</li>
<li>
<p>Paste the following content:</p>
<div class="listingblock">
<div class="content">
<pre>[Unit]
Description=OpenEMS <i class="conum" data-value="1"></i><b>(1)</b>
After=network.target <i class="conum" data-value="2"></i><b>(2)</b>

[Service]
User=root <i class="conum" data-value="3"></i><b>(3)</b>
Group=root
Type=notify <i class="conum" data-value="4"></i><b>(4)</b>
WorkingDirectory=/usr/lib/openems
LimitCORE=infinity
LimitRTPRIO=2
LimitRTTIME=60000000
CPUSchedulingPolicy=rr
CPUSchedulingPriority=1
ExecStart=/usr/lib/jvm/java-8-openjdk-armhf/bin/java -Dfelix.cm.dir=/etc/openems.d/ -jar /usr/lib/openems/openems.jar <i class="conum" data-value="5"></i><b>(5)</b>
SuccessExitStatus=143 <i class="conum" data-value="6"></i><b>(6)</b>
Restart=always <i class="conum" data-value="7"></i><b>(7)</b>
RestartSec=10 <i class="conum" data-value="8"></i><b>(8)</b>
WatchdogSec=60 <i class="conum" data-value="9"></i><b>(9)</b>

[Install]
WantedBy=multi-user.target</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The name of the service.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The service is allowed to start after network is available (e.g. to be able to access devices via ethernet connection)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>It is run as user 'root' to have access to all devices. It is recommended to change this for productive systems.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>OpenEMS notifies systemd once it is started up properly.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The start command. It uses Java 8, sets the config directory to <code>/etc/openems.d</code> and runs the jar file at <code>/usr/lib/openems/openems.jar</code></td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>In contrast to what systemd expects, Java exits with status 143 on success.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Systemd <em>always</em> tries to restart OpenEMS once it was quit.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Systemd waits <em>10</em> seconds till the next restart.</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>Systemd expects OpenEMS to trigger its watchdog once every 60 seconds. OpenEMS is doing that by default if it detects that it is run by systemd.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Press <b class="button">Ctrl</b> + <b class="button">x</b> to exit and <b class="button">y</b> to save the file.</p>
</li>
<li>
<p>Activate the service definition:</p>
<div class="paragraph">
<p>Execute <code>systemctl daemon-reload</code></p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_update_openems_edge_jar_file">4.7.1.2. Update OpenEMS Edge JAR file</h5>
<div class="paragraph">
<p>To update the OpenEMS JAR file at the target device, it is required to copy the JAR file from your build directory (see <a href="#_build_openems_edge">Build OpenEMS Edge</a>) to <code>/usr/lib/openems/openems.jar</code> on the target device. Afterwards it is required to restart the systemd service</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Copy JAR file via SCP.</p>
<div class="paragraph">
<p>In WinSCP open your local build directory on the left side and <strong>/usr/lib/openems/</strong> on the right side. Then drag and drop the file from left to right.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./img/deploy-winscp-copy.png" alt="WinSCP copy file">
</div>
<div class="title">Figure 47. WinSCP copy file</div>
</div>
</li>
<li>
<p>Restart OpenEMS systemd service.</p>
<div class="paragraph">
<p>Execute <code>systemctl restart openems --no-block; journalctl -lfu openems</code></p>
</div>
<div class="paragraph">
<p>The command restarts the service (<em>systemctl restart openems</em>) while not waiting for the OpenEMS startup notification (<em>--no-block</em>). Then it directly prints the OpenEMS system log (<em>journalctl -lfu openems</em>).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./img/deploy-openems-start.png" alt="OpenEMS Edge start-up">
</div>
<div class="title">Figure 48. OpenEMS Edge start-up</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_openems_ui">5. OpenEMS UI</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_architecture_2">5.1. Architecture</h3>

</div>
<div class="sect2">
<h3 id="_configuration_2">5.2. Configuration</h3>

</div>
<div class="sect2">
<h3 id="_faq">5.3. FAQ</h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="_openems_backend">6. OpenEMS Backend</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_architecture_3">6.1. Architecture</h3>

</div>
<div class="sect2">
<h3 id="_configuration_3">6.2. Configuration</h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="_simulation">7. Simulation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>OpenEMS provides several virtual devices for testing and development. To set up the simulation-environment follow the setup guide in <a href="#_getting_started">Getting Started</a>. The Apache Felix Web Console Configuration lists all OpenEMS component, but those which rely on external hardware can&#8217;t be used for simulation. These are replaced by more generic components tagged with the "Simulator" prefix. Still, not all non-simulator devices rely on real hardware. Other components used in production, like Loggers, Controllers and Schedulers can be combined with the virtual devices to build a "living" system.</p>
</div>
<div class="sect2">
<h3 id="_types_of_simulated_components">7.1. Types of Simulated Components</h3>
<div class="ulist">
<ul>
<li>
<p><strong>DataSource</strong>: A data-source generates lists of data and provides them as a channel to other components. The data can be generated by different means, which could be an augmented random-generator or a reader for a specific data-format like the "Simulator Datasource: CSV Reader".</p>
</li>
<li>
<p><strong>Devices</strong>: Devices replace a hardware-component like a meter or an ess. There are two kinds of devices:</p>
<div class="ulist">
<ul>
<li>
<p><strong>acting</strong>: These devices act on their own. Their actions do not depend on other device&#8217;s actions, but on data-sources.</p>
</li>
<li>
<p><strong>reacting</strong>: These devices analyse other device&#8217;s channels/properties to deduce their own behavior.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_simulator_components">7.2. Simulator Components</h3>
<div class="ulist">
<ul>
<li>
<p><code>Simulator DataSource: CSV Reader</code>: Reads .csv files and provides their content according to the <code>io.openems.edge.simulator.datasource.api.SimulatorDatasource</code> interface. Its package contains several sample csv-files for different devices and situations.</p>
</li>
<li>
<p><code>Simulator EssSymmetric Reacting</code>: Simulates the State of Charge of a ess device. Its behavior depends on configured controllers.</p>
</li>
<li>
<p><code>Simulator GridMeter Acting</code>: Intended to represent grid consumption/production. Portrays a datasource' values. It requests those tagged with the "ActivePower" key. The values are portrayed in the <code>SimulatedActivePower</code>, <code>ActivePower</code> and - divided by three - in the <code>ActivePowerL1</code>, <code>ActivePowerL2</code> and <code>ActivePowerL3</code> channels.</p>
</li>
<li>
<p><code>Simulator ProductionMeter Acting</code>: Intended to represent fixed production like photovoltaic arrays. To date the functionality equals the one of <code>Simulator GridMeter Acting</code>.</p>
</li>
<li>
<p><code>Simulator NRCMeter Acting</code>: Intended to represent non-regulated-consumption. To date the functionality equals the one of <code>Simulator GridMeter Acting</code>.</p>
</li>
<li>
<p><code>Simulator GridMeter Reacting</code>: Intended to represent grid consumption/production. Takes all meters (but grid-meters) and esss, sums up their ActivePowers and divides this value by the number of grid-meters in the system. The negative of this result is then portrayed in the <code>SimulatedActivePower</code>, <code>ActivePower</code> and - divided by three - in the <code>ActivePowerL1</code>, <code>ActivePowerL2</code> and <code>ActivePowerL3</code> channels. This equals the physical reaction of the real grid.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_possible_combinations">7.3. Possible Combinations</h3>
<div class="paragraph">
<p>In reality the OpenEMS can not measure the non-regulated-consumers, as they are spread all over the building. However, it can measure the power at the mains connection, which can be used to calculate the non-regulated-consumption. This approach can be simulated using the <code>Simulator GridMeter Acting</code> combined with a <code>Simulator EssSymmetric Reacting</code>.</p>
</div>
<div class="paragraph">
<p>For intelligent systems going beyond real-time-regulation, however, having a - even in production - virtual meter measuring the non-regulated-consumers can be a major advantage. In order to test algorithms depending on such an environment, the simulator provides the <code>Simulator ProductionMeter Acting</code>, the <code>Simulator NRCMeter Acting</code> and the <code>Simulator GridMeter Reacting</code>.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2018-08-24 15:45:59 DST
</div>
</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/styles/github.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/highlight.min.js"></script>
<script>hljs.initHighlighting()</script>
</body>
</html>